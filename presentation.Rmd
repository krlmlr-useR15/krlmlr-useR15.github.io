---
title: "Improving computational performance with algorithm engineering"
author: "Kirill MÃ¼ller"
date: "July 1, 2015"
output: ioslides_presentation
---

```{r echo=FALSE}
library(ggplot2)
set.seed(20150619L)
```

## Algorithm engineering

> Design, analysis, implementation, optimization, profiling and experimental evaluation of computer algorithms. (*Wikipedia*)

Here: Substitute existing implementation by an algorithm
with a lower computational complexity.

**Examples**

1. Weighted random sampling without replacement
2. Similarity-based statistical matching
3. Survey calibration
4. Package management


## Random sampling

```{r}
sample.int
```

- `replace`: With or without replacement
- `prob`: Uniform or non-uniform probabilities


## Implementation of random sampling

Common framework:

- Subdivide an interval according to probabilities
- Uniformly sample point from interval
- Choose sub-interval covered by point
- If sampling without replacement, remove sub-interval

```{r echo=F}
interval_fig_height <- 0.7
ggplot_interval <-
  list(
    theme_classic(),
    theme(text = element_blank(), axis.line = element_blank(),
          axis.ticks = element_blank()),
    scale_color_identity(),
    coord_flip(),
    theme(plot.margin = grid::unit(c(0,0,0,0), "line")),
    NULL
  )
```



## Implementation of random sampling

Common framework:

- **Subdivide an interval according to probabilities**
- Uniformly sample point from interval
- Choose sub-interval covered by point
- If sampling without replacement, remove sub-interval

```{r echo=FALSE, fig.height=interval_fig_height}
N <- 10
prob <- prop.table(runif(N))
d <- data.frame(y=prob, yy=1/N)
ggplot(d, aes(x=0, y=y, group=0)) +
  ggplot_interval +
  geom_bar(position="stack", stat="identity", fill=NA, color="black")
```




## Implementation of random sampling

Common framework:

- Subdivide an interval according to probabilities
- **Uniformly sample point from interval**
- Choose sub-interval covered by point
- If sampling without replacement, remove sub-interval

```{r echo=FALSE, fig.height=interval_fig_height}
yr <- runif(1)
d$r <- c(0, diff(cumsum(d$y) < yr))
ggplot(d, aes(x=0, y=y, group=0)) +
  ggplot_interval +
  geom_bar(position="stack", stat="identity", fill=NA, color="black") +
  geom_point(x=0, y=yr, color = "red")
```



## Implementation of random sampling

Common framework:

- Subdivide an interval according to probabilities
- Uniformly sample point from interval
- **Choose sub-interval covered by point**
- If sampling without replacement, remove sub-interval

```{r echo=FALSE, fig.height=interval_fig_height}
ggplot(d, aes(x=0, y=y, group=0)) +
  ggplot_interval +
  geom_bar(aes(fill=ifelse(r, "green", NA)), position="stack", stat="identity", color=NA) +
  geom_bar(position="stack", stat="identity", fill=NA, color="black") +
  scale_fill_identity() +
  geom_point(x=0, y=yr, color = "red")
```


## Implementation of random sampling

Common framework:

- Subdivide an interval according to probabilities
- Uniformly sample point from interval
- Choose sub-interval covered by point
- **If sampling without replacement, remove sub-interval**

```{r echo=FALSE, fig.height=interval_fig_height}
d$f <- NA_integer_
d$f[!d$r] <- seq_len(sum(!d$r))
ggplot(d, aes(x=0, y=y, group=0, fill=f)) +
  ggplot_interval +
  geom_bar(position="stack", stat="identity", color="black") +
  scale_fill_gradientn(colours = rainbow(23), guide = FALSE)
```


```{r echo=FALSE, fig.height=interval_fig_height}
ggplot(d[!d$r,], aes(x=0, y=y, group=0, fill=f)) +
  ggplot_interval +
  geom_bar(position="stack", stat="identity", color="black") +
  scale_fill_gradientn(colours = rainbow(23), guide = FALSE)
```


## Random sampling with replacement

Simple case:

- No need to remove sub-interval
- Uniform probabilities: No need for explicit interval
- Nonuniform probabilities: Binary search?
    - Better: Walker's alias method (used in R for large number of not
  entirely unlikely elements)

```{r echo=FALSE, fig.height=interval_fig_height}
ggplot(d, aes(x=0, y=y, group=0)) +
  ggplot_interval +
  geom_bar(aes(fill=ifelse(r, "green", NA)), position="stack", stat="identity", color=NA) +
  geom_bar(position="stack", stat="identity", fill=NA, color="black") +
  scale_fill_identity() +
  geom_point(x=0, y=yr, color = "red")
```



## Slide with Bullets

- Bullet 1
- Bullet 2
- Bullet 3

## Slide with R Code and Output

```{r}
summary(cars)
```

## Slide with Plot

```{r, echo=FALSE}
plot(cars)
```

